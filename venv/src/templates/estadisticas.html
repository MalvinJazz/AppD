{% extends 'base.html' %}

{% block head %}
<h1>ESTADISTICAS</h1>
{% endblock %}

{% block content %}
<div id='section'>
  <div id="sectionTitle">
    <h1>Total de denuncias</h1>
  </div>
  <div id="chart_div" class="geoChart" ></div>
  <div class="total"><h3><i>Total: {{total}}</i></h3></div>
  <div class="graficas">
    <div id="piechart"></div>
    <div id="columnchart"></div>
  </div>
</div>
{% endblock %}


{% block js %}
<script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

  google.charts.load('visualization', '1', {'packages': ['geochart', 'corechart']});
  google.charts.setOnLoadCallback(drawMarkersMap);
  // google.charts.load('visualization', '1', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);
  // google.charts.load('current', {'packages':['corechart']});
  // google.charts.setOnLoadCallback(drawChart);

  function drawMarkersMap() {

    var deps = [
        ['States','Departamento', 'Denuncias'],
        {% for dato in departamentos %}
          ['{{dato.codigo}}','{{dato.nombre}}',{{dato.sumMunicipios}}],
        {% endfor %}
      ];

    var datos = google.visualization.arrayToDataTable(deps);

    var options = {
       backgroundColor: '#white',
       datalessRegionColor: '#C0C0C0',
       defaultColor: '#4D4D50',
       region: 'GT',
       //displayMode: 'markers',
       resolution: 'provinces',
       //FAE398
       colorAxis: {colors: ['#FDF1CB','#FFC400','#DF0000']},
    };

    var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
    chart.draw(datos, options);

    google.visualization.events.addListener(chart, 'select', function() {
      var seleccion = chart.getSelection();
      var code = datos.getValue(seleccion[0].row, 0);
      var dep = datos.getValue(seleccion[0].row, 1);
      console.log(code);

      $.ajax({

        data: {'code': code},
        url: "{% url 'local:dens' %}",
        type: 'get',
        success: function(data){

          // var tabla = new google.visualization.DataTable();
          // data.addColumn('string', 'Municipio');
          // {% for dato in motivos %}
          //   data.addColumn('number', '{{dato.motivo}}');
          // {% endfor %}
          for(var i=0; i<data.length;i++){
            console.log(data[i].fields);
          }

          // var options = {
          //   title: dep,
          //   legend: { position: 'top', maxLines: 4 },
          //   bar: { groupWidth: '75%' },
          //   isStacked: true,
          // };
          //
          // var chart = new google.visualization.ColumnChart(document.getElementById('columnchart'));
          //
          // chart.draw(tabla, options);

        }

      })


    });
  };

  function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Motivo', 'Denuncias'],
          {% for dato in motivos %}
            ['{{dato.motivo}}',{{dato.sumTotal}}],
          {% endfor %}
        ]);

        var options = {
          title: 'Motivos de Denuncias'
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
    };


</script>

{% endblock %}
