{% extends 'base.html' %}

{% block head %}
  <h1>REALIZAR DENUNCIA</h1>
{% endblock %}

{% block content %}
<div id="section">
  <div>
    <div class = "radioBtn">
      <div class="bloqueOne">
        <input type="radio" name="tipo" value="anonimo" checked onClick="deshabilita()">
        <label>Anonima</label></br>
      </div>
      <div class="bloqueTwo">
        <input type="radio" name="tipo" value="personal" onClick="habilita()">
        <label>Personal</label> </br>
      </div>
    </div>
  </div>
  <div id="bloqueForms">
    <form id="form1" method="POST" action='' enctype='multipart/form-data'>
      {% csrf_token %}
        <div class="form-group">
          <div id="ident" style="display: none;">
            <div>
              <label>Nombre</label>
                {{form.nombre}} </br>
            </div>
            <div>
              <label>DPI</label>
                {{form.dpi}} </br>
            </div>
            <div>
              <label>Telefono</label>
                {{form.telefono}}</br>
            </div>
          </div>
          <div>
            <label>Departamento</label>
            <select id="dep" name="dep">
              <option value="0" selected>------</option>
              {% for dato in departamentos %}
                <option value="{{dato.id}}">{{dato.nombre}}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label>Municipio</label>
            <select id="muni_id" name="muni">
              <option selected></option>
            </select>
          </div>
          <div>
          <label>Direccion</label>
            {{form.direccion}} </br>
          </div>
          <div>
            <label>Referencia</label>
              {{form.referencia}}</br><span id="help1" class="help">....</span></br>
          </div>
          <!-- <div id="map_canvas" style="height: 200px; width: 300px"></div> -->
          <div>
          <label>Foto/Video</label>
            <input type="file" id="file" name="file"></br>
          </div>
          <div>
            <label>Institucion</label>
            <select id="inst" name="inst">
              <option selected>------</option>
              {% for dato in instituciones %}
                <option value="{{dato.id}}">{{dato.nombre}}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label>Motivo</label>
              {{form.motivo}} </br>
          </div>
          <div>
          <label>Denuncia</label>
            {{form.denuncia}} </br>
          </div>
          <div id="btnForm">
            <input type="submit" class="btn btn-default" value='Enviar'>
          </div>
          <div id="coord" style="display: none;">
            <input id="lat" type="text" name="lat" value=0>
            <input id="lon" type="text" name="lon" value=0>
          </div>
        </div>
    </form>
  </div>
</div>
{% endblock %}

{% block js %}

<script type = "text/javascript">

  $('#dep').on('change', busquedaMuni);
  $('#muni_id').on('change', busquedaDir);
  $('#inst').on('change', busquedaMot);
  $('#help1').on('click', mostrar);
  $('#document').ready(getGeolocation);

  document.getElementById('muni_id').length = 0;
  document.getElementById('id_direccion').length = 0;
  document.getElementById('id_motivo').length = 0;

  function habilita(){
    document.getElementById("id_nombre").disabled = false;
    document.getElementById("id_dpi").disabled = false;
    document.getElementById("ident").style.display = 'block'
  }

  function deshabilita(){
    document.getElementById("id_nombre").disabled = true;
    document.getElementById("id_dpi").disabled = true;
    document.getElementById("ident").style.display = 'none';
  }

  function busquedaMuni(){

    var id = $(this).val();
    $.ajax({

      data: {'id': id},
      url: "{% url 'local:muni' %}",
      type: 'get',
      success: function(data){

        var inner = document.getElementById('muni_id');

        inner.innerHTML = "";
        var p = document.createElement("option");

        // console.log(data[i].fields.nombre)

        p.value = "0";
        p.innerHTML = "------";

        inner.options.add(p);
        for (var i = 0; i<data.length; i++){

          var nuevo = document.createElement("option");

          // console.log(data[i].fields.nombre)

          nuevo.value = data[i].pk;
          nuevo.innerHTML = data[i].fields.nombre;

          inner.options.add(nuevo);

        }

      }

    })

  }

  function busquedaDir(){

    var id = $(this).val();
    $.ajax({

      data: {'id': id},
      url: "{% url 'local:dirs' %}",
      type: 'get',
      success: function(data){
        document.getElementById('id_direccion').length = 0;

        var inner = document.getElementById('id_direccion');
        console.log(inner);

        // console.log(data[i].fields.nombre)

        for(var i = 0; i<data.length; i++){

          var nuevo = document.createElement("option");

          console.log(data[i].fields.direccion);

          nuevo.value = data[i].pk;
          nuevo.innerHTML = data[i].fields.direccion;

          inner.options.add(nuevo);

        }

      }

    })

  }

  function busquedaMot(){

    var id = $(this).val();
    $.ajax({

      data: {'id': id},
      url: '/busqMot/mots',
      type: 'get',
      success: function(data){

        document.getElementById('id_motivo').length = 0;

        var inner = document.getElementById('id_motivo');
        console.log(inner);

        for(var i = 0; i<data.length; i++){

          var nuevo = document.createElement("option");

          console.log(data[i].fields.motivo);

          nuevo.value = data[i].pk;
          nuevo.innerHTML = data[i].fields.motivo;

          inner.options.add(nuevo);

        }

      }

    })

  }

  function mostrar(){
    alert('Escribe un lugar de referencia a la direccion.')
  }


  // if (navigator.geolocation) {
  //   navigator.geolocation.getCurrentPosition(function(position) {
  //   var lat = position.coords.latitude;
  //   var lng = position.coords.longitude;
  //   var options = { position: new google.maps.LatLng(lat, lng) }
  //   var marker = new google.maps.Marker(options);
  //   marker.setMap(map);
  //   });
  // }
  //
  // var map = null;
	// var marker = new google.maps.Marker();

	// function load_map() {
	//     var myLatlng = new google.maps.LatLng(20.68009, -101.35403);
	//     var myOptions = {
	//         zoom: 4,
	//         center: myLatlng,
	//         mapTypeId: google.maps.MapTypeId.ROADMAP
	//     };
	//     map = new google.maps.Map($("#map_canvas").get(0), myOptions);
	// }

	function getGeolocation() {
		if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(function(position){

          var lat = position.coords.latitude;
          var lon = position.coords.longitude;

          document.getElementById('lat').value = lat;
          document.getElementById('lon').value = lon;
        });
		} else {
			alert("Para utilizar la geolocalizaciÃ³n necesitas actualizar tu navegador.");
		}
	}

	// $(document).ready(function(){
  //   getGeolocation();
	// });

  // var map;
  // function initMap() {
  //   getGeolocation(lat, lon);
  //   map = new google.maps.Map(document.getElementById('map_canvas'), {
  //     center: {lat: lat, lng: lon},
  //     zoom: 15
  //   });
  // }
</script>

<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPIn8C1d9dQLNNnv-Z2D0AKz6WESeZ8tI&callback=initMap"
    async defer></script> -->

{% endblock %}
